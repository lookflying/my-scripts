#!/usr/bin/python
# -*- coding:UTF-8 -*-
import requests, shutil
import urllib
import os
import time
import sys
global header_info
fail_list = []
cookies = dict(bgPicName="Default", c_expiresintv="0", c_secure_uid="MzY0Mw%3D%3D", c_secure_pass="7b87894fa24bed43c370715170fcf48e", c_secure_ssl="eWVhaA%3D%3D", c_secure_login="bm9wZQ%3D%3D", __utmt="1", __utma="248584774.159802578.1409997105.1412675485.1412678192.25", __utmb="248584774.32.10.1412678192", __utmc="248584774",)
def fetch():
    if not os.path.exists("torrents"):
        os.makedirs("torrents")
    urls = [123640,123493,123408,123353,123331,123332,122648,123145,123121,115391,122857,122808,122804,74157,122687,121480,47975,122638,87465,122514,122428,122153,122296,122560,121971,122609,121792,122614,122548,122504,122454,122432,122423,122394,122416,122344,122298,122269,28971,2009,122219,122139,122216,122187,59957,122038,56826,121967,121937,121894,121901,121812,6506,117423,121234,121677,121676,121714,121598,121583,121522,121471,121335,52032,121330,31172,121305,116679,121213,121217,101600,121112,121095,121050,120973,120939,120883,120875,120810,120780,119680,110421,120688,120689,120631,120583,120523,120519,120499,120386,120381,120353,120351,120334,120279,120213,120243,120131,120126,119979,119976,119967,119952,119926,119873,119866,119867,108170,119554,119781,119769,119632,119390,119520,119426,119425,119391,119352,119303,119172,119146,119106,119002,118962,118963,118940,118941,36566,118710,118695,118672,118583,118464,118480,114591,84947,118058,85400,118108,108393,24409,115549,117959,117935,117839,117922,117885,117870,117121,117645,117454,117379,117307,117239,117117,117137,116854,116741,116744,116709,116489,6545,116551,116524,116398,116295,116301,116252,116199,116184,58461,115946,115294,115844,115457,115731,115672,115670,115416,115494,115367,115317,115187,80362,115159,115102,114961,115055,115046,115064,114976,114395,114900,113416,114639,113309,67025,114846,113928,114455,114702,114198,113638,114778,102631,114734,114678,114289,114579,114574,114551,114535,114517,114451,114368,2105,114341,114314,114309,114282,114287,108416,114215,114002,83526,114076,114004,94716,84589,113814,113748,113749,113673,113219,112707,112706,113483,113221,113220,112704,112705,112703,113464,113370,113332,113283,113272,113235,113166,113189,113096,113081,112946,112905,112869,112845,112855,112847,112808,112635,112606,32814,112601,110473,112521,112506,105322,112492,112485,112453,7597,101392,112435,112455,112437,112412,112294,112317,56779,112191,112125,1917,104296,112104,112049,112028,112079,112071,112010,111982,111902,111005,111679,30069,38813,111647,111515,111572,97507,25617,103432,85719,111549,111501,110792,111509,111341,111339,111309,111226,82051,100975,2805,110958,110895,110636,110912,107400,110809,110795,110831,110762,91952,110720,110613,110640,110418,110586,110434,110502,105311,110285,97798,110472,78893,110474,110346,110133,110289,110101,110028,109738,109956,109926,109925,109856,109726,109761,109702,109584,109574,109413,109350,109258,109271,106803,107815,109269,109161,109082,109041,74065,106571,108872,100257,108856,108688,108475,108676,108518,108417,108316,108301,108212,108218,107441,108029,107980,107889,107844,107813,106058,107605,107593,107562,107442,107409,105991,100020,107168,106992,106769,106994,106302,106908,106849,106804,106511,106513,106581,106510,106459,106207,106178,106028,3718,105854,105812,105735,105657,105658,105601,105586,98532,105500,105494,105478,105235,105000,105255,71072,105006,104691,100912,86590,104323,104308,103996,104034,103764,103585,103269,103242,103221,102977,103027,102630,102859,102564,102507,102469,102398,102107,101920,101736,101741,101483,101206,101316,101260,101159,95722,101102,101070,100817,100754,100692,96073,100540,96840,100308,42277,100248,100245,100185,100043,96998,1176,99586,99353,99016,98391,98766,98485,98429,98195,98289,97883,97885,97501,4764,96563,53240,96377,96218,96068,80865,95967,95905,95885,95878,94923,95732,95700,95664,37327,92908,95564,95462,95288,95322,95263,95246,3705,95103,88863,72668,95014,95011,94851,39935,55445,94618,94630,94624,94580,3224,94420,94161,60902,94115,94059,94021,62918,93645,93031,92994,92834,91402,92673,92542,75825,73002,92479,92393,92350,4668,92235,92165,92142,24608,91950,79304,91899,91641,91552,91533,28809,91445,91425,90970,37844,89557,91142,91180,90883,90527,90210,87394,89342,88025,86768,88724,90257,21244,89666,78329,89401,89073,89068,88343,84140,87540,87588,42624,87440,86871,87362,87290,87284,87092,86625,86587,86536,84373,86497,77434,85921,85946,85838,85872,85848,85652,85709,85471,81753,85232,85316,85137,83833,84453,85020,44685,84171,83812,83809,83776,83631,83420,83269,83372,73100,83273,83295,83154,83168,82969,82923,74534,82733,82656,82599,82602,82470,82503,82358,82313,82312,82072,81418,82188,82119,82109,82044,24421,81967,81912,68048,81866,81853,81829,81720,5739,81690,81688,70392,81667,81671,81683,81634,81643,81622,81005,81610,77197,74560,81614,81612,78590,81603,81514,81498,81491,80863,81461,80041,81214,81172,81060,79512,2647,80708,80670,79442,63049,80443,80289,74216,79650,80128,79529,80141,80109,80116,79276,79136,78883,78877,78849,78790,78585,78491,78059,1014,78349,78213,78073,78012,77907,77829,77848,77729,77676,69036,69911,42765,74444,77348,75120,77304,77230,77206,71589,140,77169,77049,76987,76859,77003,76928,76926,76881,76823,76690,76586,76568,76513,76436,76426,75981,74497,75206,76311,76265,73192,76047,75990,75863,20329,75743,75783,62725,75504,75412,32346,18568,75263,75176,75036,75012,74869,74855,74718,6416,74377,74193,74062,23848,73850,73820,24045,73630,73489,73419,73325,73111,73082,73061,73005,72993,72920,25608,58784,72308,72802,72238,72652,72655,72659,72446,72181,5143,12257,71601,8006,71343,23598,71253,71079,70710,70912,70834,70712,59077,70263,70374,34587,58232,8391,54997,69473,69411,69173,69196,40167,68976,57339,67977,67906,68663,68961,68889,68360,68260,67948,46178,67874,34310,67823,9468,31027,67749,67742,1531,67724,67672,67589,67529,2368,5722,67469,7902,56228,67339,67292,15757,66825,66673,66701,66656,66600,66504,33908,56332,66359,66340,66327,66239,66225,64542,64079,66063,65101,66058,63779,63782,63781,66158,66038,66073,66062,57930,62545,65999,39048,65687,65557,65520,39403,10625,2166,65494,65417,65115,65118,65058,60966,64750,65089,62313,64757,64774,64455,64767,62748,57502,64327,64536,64520,64352,22705,2923,64265,64172,64187,64150,4175,64105,64046,36334,64022,63832,63883,63880,63844,63444,63334,63313,29082,62867,62829,62500,62612,62573,32203,62250,62215,62196,2994,62133,61783,61667,62006,61662,61922,61926,31653,46925,380,31031,61481,61339,61322,61252,61174,60694,49815,20801,60329,60811,60576,60526,60534,60415,59805,59768,59734,59494,30687,59161,59019,58987,58996,8025,58785,13329,58708,57959,58312,57914,56454,58204,58243,58140,57989,57983,57878,57904,57708,57699,57604,57214,57052,57042,56956,56935,16999,56730,56632,56634,56690,34378,55389,41865,6287,55944,55855,55806,55773,55799,55777,55748,55722,55697,55645,55631,55409,55394,55344,54645,54468,55151,55108,54858,54849,54791,54724,54686,54687,54688,54548,54502,54519,54407,400,49758,54209,54065,53872,53879,46813,53655,53551,53449,53247,52599,52855,52541,47397,17994,38449,52062,30394,51982,51947,51939,11056,51841,51842,51194,51123,43710,50914,50913,50620,50730,7312,50047,3576,35623,50343,50239,50243,10149,49987,47195,49284,49761,49647,49362,48871,49171,38233,48398,48851,28765,48791,22087,48665,44184,48594,48575,48548,27846,48449,48325,48159,43212,47945,47858,47856,31109,25003,32028,47675,47587,47490,47464,47456,47398,47245,19642,43419,47187,47182,20362,43954,46721,46756,36330,20238,2365,46483,7209,46111,1074,43303,46084,46011,45868,45797,45724,45176,45410,44656,44554,44354,43950,43399,43356,43032,43241,42771,42766,42556,42528,42276,41515,41588,41413,41440,41219,40569,41131,30576,16282,41038,40908,40872,40842,40681,40613,40275,40010,40049,39789,39735,39664,13014,14615,38987,24172,39484,38483,39367,39035,39069,35357,38836,25399,38740,23126,27337,33756,31411,38545,38530,38425,38288,38278,38284,38247,8018,38204,33796,19016,20307,38050,37983,37994,37816,37879,37836,37641,37605,37603,33123,37482,37480,37434,37089,28483,178,206,37133,19292,37028,37069,36998,2149,36769,36454,36639,36409,36272,36153,35602,22914,34913,29103,34928,35084,34938,31081,31417,4878,34020,33785,33723,33705,33193,32847,32771,27799,32285,31596,31963,31279,31203,925,1895,30940,30063,16432,30327,20450,28884,28883,28874,28832,28391,27515,27178,27394,27318,27107,26978,26654,1834,25839,25612,25227,25128,25172,19007,17936,25121,24912,24831,24768,24438,14565,3713,10319,24137,23717,23322,23642,23031,23276,22674,1355,101,22716,16639,22386,4759,22293,21061,16477,22182,12363,22117,20420,20074,21842,21265,21407,21282,10525,21239,21221,19242,14914,21128,21203,21149,21114,4073,6543,21042,5103,20902,20785,245,20640,5423,18795,16368,14463,20385,20337,4564,5797,19389,19222,19001,18164,18843,17644,6314,9895,17796,17309,15497,18420,6160,17736,14182,16020,17470,17425,15336,17089,16656,16585,11649,16584,14227,14604,14042,12219,13522,13463,12264,8121,7607,8993,12796,11979,4360,10871,10507,2708,11991,10963,10876,10750,10477,9124,9442,9954,5202,2420,7981,8323,8255,8181,8007,8074,7866,7214,6819,2530,6302,1594,691,308,5433,5290,4777,3275,2487]

    for url in urls:
        print str(url)
        download(str(url), 0)
        time.sleep(1)
        
def download(url, count):
    if count > 10:
        sys.stderr.write(str(url) + "\n")
        fail_list.append(url)
        return
    try:
      r = requests.get('https://pt.sjtu.edu.cn/download.php?id=' + url, cookies=cookies, stream=True)
      name = urllib.unquote(r.headers['Content-Disposition'].split(";")[1].strip().replace('filename=',''))
      print name
      if r.status_code == 200:
          with open('torrents/' + name, 'wb') as f:
              r.raw.decode_content = True
              shutil.copyfileobj(r.raw, f)
    except Exception, e:
              time.sleep(count + 1)
              download(url, count + 1)

if __name__ == '__main__':
    fetch()
    print "fail list:"
    for each in fail_list:
        print(str(each))



